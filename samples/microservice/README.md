# Microservice Example

This directory contains trivial Node.JS microservice with two
endpoints:

- `/new-patient` - creates Patient resource with random given/family names;
- `/fhir-proxy/*` - proxies all incoming requests to aidbox. Forbids
  "Voldemort" word in request's payload.

## Running it locally

Please run devbox first. Then perform `npm install` to get all the
dependencies. Then run:

    $ AIDBOX_URL=http://localhost:8888 npm run dev

If you're running devbox on different port (not 8888) then you have to
correct AIDBOX_URL value accordingly.

When service is started, you can start making HTTP requests to it:

This query will create new Patient resource:

```http
POST http://localhost:3000/fhir-proxy/Patient/
Content-Type: application/json

{ "resourceType": "Patient", "name": [{ "given": ["Foo"], "family": "Smith" }] }
```

This query will create new Patient resource with autogenerated name:

```http
POST http://localhost:3000/new-patient
```

This query will return all stored Patient resources:

```http
GET http://localhost:3000/fhir-proxy/Patient
```

This query will fail because it contains "Voldemort" word (remember
that check in `/fhir-proxy` endpoint?):

```http
POST http://localhost:3000/fhir-proxy/Patient/
Content-Type: application/json

{ "resourceType": "Patient", "name": [{ "given": ["Voldemort"], "family": "Smith" }] }
```

## Building Docker image

Also there is a Dockerfile to build docker image for Kubernetes or
Docker-compose deployment. TODO: ellaborate on that topic.
